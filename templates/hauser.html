{% extends "base.html" %}

{% block title %}í•˜ìš°ì € ë³€í™˜ê¸° - ì›¹ ê¸°ë°˜ í†µí•© ì£¼ë¬¸ ë„êµ¬{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- í—¤ë” -->
            <div class="text-center mb-5">
                <h1 class="display-5 fw-bold text-success">
                    <i class="fas fa-table me-3"></i>í•˜ìš°ì € ë³€í™˜ê¸°
                </h1>
                <p class="lead text-muted">ì—‘ì…€ íŒŒì¼ì„ í•˜ìš°ì € ì–‘ì‹ì— ë§ê²Œ ë³€í™˜í•©ë‹ˆë‹¤</p>
            </div>

            <!-- í”Œë˜ì‹œ ë©”ì‹œì§€ -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <!-- ì—…ë¡œë“œ í¼ -->
            <div class="card shadow-lg">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-upload me-2"></i>ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ</h5>
                </div>
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data">
                        <div class="mb-4">
                            <label for="excel_file" class="form-label fw-bold">
                                <i class="fas fa-file-excel me-2"></i>ì—‘ì…€ íŒŒì¼ ì„ íƒ
                            </label>
                            <input type="file" class="form-control" id="excel_file" name="excel_file" accept=".xlsx,.xls" required>
                            <div class="form-text">
                                <i class="fas fa-info-circle me-1"></i>
                                .xlsx ë˜ëŠ” .xls íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤. (ìµœëŒ€ 10MB)
                            </div>
                        </div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-success btn-lg" id="hauserSubmitBtn">
                                <i class="fas fa-magic me-2"></i>ë³€í™˜í•˜ê¸°
                            </button>
                            <div id="hauserLoading" class="mt-2" style="display: none;">
                                <div class="spinner-border text-success" role="status">
                                    <span class="visually-hidden">ë³€í™˜ ì¤‘...</span>
                                </div>
                                <span class="ms-2">ë³€í™˜ ì¤‘ì…ë‹ˆë‹¤...</span>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- ê²°ê³¼ í‘œì‹œ -->
            {% if result %}
            <div class="card shadow-lg mt-5">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-check-circle me-2"></i>ë³€í™˜ ê²°ê³¼</h5>
                </div>
                <div class="card-body">
                    
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h6 class="fw-bold">âœ… ë³€í™˜ ì™„ë£Œ</h6>
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle me-2"></i>
                                {{ result.message or 'í•˜ìš°ì € ë³€í™˜ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!' }}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6 class="fw-bold">ğŸ“ ë‹¤ìš´ë¡œë“œ</h6>
                            <div class="d-grid gap-2">
                                <a href="/download/{{ result.filename }}" class="btn btn-success btn-lg">
                                    <i class="fas fa-download me-2"></i>ë³€í™˜ëœ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- ë³€í™˜ ê²°ê³¼ ì•ˆë‚´ -->
                    <div class="alert alert-info">
                        <h6 class="fw-bold mb-2"><i class="fas fa-info-circle me-2"></i>ë³€í™˜ ê²°ê³¼ ì•ˆë‚´</h6>
                        <ul class="mb-0">
                            <li><strong>K~Lì—´</strong>: ì›ë³¸ ìƒí’ˆëª…ê³¼ ìˆ˜ëŸ‰ (íšŒìƒ‰ìœ¼ë¡œ í‘œì‹œ)</li>
                            <li><strong>M~Nì—´ë¶€í„°</strong>: ë³€í™˜ëœ í•˜ìš°ì € ë²ˆí˜¸ì™€ ìˆ˜ëŸ‰</li>
                            <li><strong>ê²€ì •ìƒ‰</strong>: ì •ìƒ ë³€í™˜ëœ ìƒí’ˆ</li>
                            <li><strong>íŒŒë€ìƒ‰</strong>: ìˆ˜ëŸ‰ í™•ì¸ì´ í•„ìš”í•œ ìƒí’ˆ</li>
                            <li><strong>ë¹¨ê°„ìƒ‰</strong>: ë³€í™˜ ì‹¤íŒ¨í•œ ìƒí’ˆ (í•˜ë‹¨ìœ¼ë¡œ ì´ë™/ ë¯¸ë³€í™˜ ìƒí’ˆì´ í¬í•¨ëœ ì£¼ë¬¸ ê±´ì˜ ê²½ìš° ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í‘œì‹œë  ìˆ˜ ìˆìŒ í™•ì¸í•„ìš”)</li>
                        </ul>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- ì‚¬ìš©ë²• ì•ˆë‚´ -->
            <div class="card shadow-lg mt-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-question-circle me-2"></i>ì‚¬ìš©ë²• ì•ˆë‚´</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="fw-bold text-primary">ğŸ“‹ ë³€í™˜ ê³¼ì •</h6>
                            <ol class="list-group list-group-numbered">
                                <li class="list-group-item">Kì—´ì˜ ìƒí’ˆëª…ì„ ì½ì–´ì˜µë‹ˆë‹¤</li>
                                <li class="list-group-item">ì¤„ë°”ê¿ˆ ê¸°ì¤€ìœ¼ë¡œ ìƒí’ˆëª…ì„ ë¶„ë¦¬í•©ë‹ˆë‹¤</li>
                                <li class="list-group-item">ê° ìƒí’ˆëª…ì— ë§ëŠ” í•˜ìš°ì € ë²ˆí˜¸ë¥¼ ì°¾ìŠµë‹ˆë‹¤</li>
                                <li class="list-group-item">ê²°ê³¼ë¥¼ ìƒˆë¡œìš´ ì—‘ì…€ íŒŒì¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤</li>
                            </ol>
                        </div>
                        <div class="col-md-6">
                            <h6 class="fw-bold text-success">âœ… ë³€í™˜ ì¡°ê±´</h6>
                            <ul class="list-group">
                                <li class="list-group-item">
                                    <i class="fas fa-check text-success me-2"></i>
                                    ëª¨ë¸ëª…: ìƒí’ˆëª… ê´„í˜¸ ì•ˆì— ì°¸ì¡° ëª¨ë¸ëª… í¬í•¨
                                </li>
                                <li class="list-group-item">
                                    <i class="fas fa-check text-success me-2"></i>
                                    ìƒ‰ìƒ: ìƒí’ˆëª…ì— ì°¸ì¡° ìƒ‰ìƒ í¬í•¨
                                </li>
                                <li class="list-group-item">
                                    <i class="fas fa-check text-success me-2"></i>
                                    ë†’ì´: ìƒí’ˆëª… ê´„í˜¸ ì•ˆì— ì°¸ì¡° ë†’ì´ í¬í•¨
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// í•˜ìš°ì € ë³€í™˜ ë¡œë”© í‘œì‹œ í•¨ìˆ˜
function showHauserLoading() {
    document.getElementById('hauserLoading').style.display = 'block';
    document.getElementById('hauserSubmitBtn').disabled = true;
}

// ë¡œë”© ìˆ¨ê¸°ê¸° í•¨ìˆ˜
function hideHauserLoading() {
    document.getElementById('hauserLoading').style.display = 'none';
    document.getElementById('hauserSubmitBtn').disabled = false;
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    // í•˜ìš°ì € ë³€í™˜ í¼ ì œì¶œ ì‹œ ë¡œë”© í‘œì‹œ
    const hauserForm = document.querySelector('form[method="POST"]');
    if (hauserForm) {
        hauserForm.addEventListener('submit', function() {
            showHauserLoading();
        });
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œë”© ìˆ¨ê¸°ê¸° (í¼ ì œì¶œ í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ)
    hideHauserLoading();
});
</script>

{% endblock %}